(function(){const n=document.getElementById("search-input"),e=document.getElementById("search-results"),t=document.getElementById("search-meta");if(!n||!e)return;const l="/index.json";let s=[];const o=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),d=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=(e,t)=>{if(!t)return o(e);const n=new RegExp(d(t),"gi");return o(e).replace(n,e=>`<mark>${e}</mark>`)},a=(e,t)=>{if(!e)return"";const i=e.toLowerCase(),a=t.toLowerCase(),n=i.indexOf(a);if(n===-1)return"";const s=Math.max(0,n-60),o=Math.min(e.length,n+80),r=s>0?"…":"",c=o<e.length?"…":"";return r+e.slice(s,o)+c},r=(n,s)=>{if(e.innerHTML="",!n.length){t.textContent=s?"没有找到匹配内容":"";return}t.textContent=`找到 ${n.length} 条结果`;const o=document.createDocumentFragment();n.forEach(e=>{const t=document.createElement("article");t.className="search-card";const c=document.createElement("h2");c.className="search-title",c.innerHTML=i(e.title||"Untitled",s);const l=document.createElement("a");l.href=e.permalink||e.url||"#",l.appendChild(c);const u=a(e.summary||"",s)||a(e.content||"",s)||e.summary||e.content||"",d=document.createElement("p");d.className="search-snippet",d.innerHTML=i(u,s);const n=document.createElement("div");n.className="search-meta-line";const r=[];e.date&&r.push(e.date),Array.isArray(e.tags)&&e.tags.length&&r.push(`#${e.tags.join(" #")}`),Array.isArray(e.series)&&e.series.length&&r.push(`Series: ${e.series.join(", ")}`),n.textContent=r.join(" · "),t.appendChild(l),u&&t.appendChild(d),n.textContent&&t.appendChild(n),o.appendChild(t)}),e.appendChild(o)},u=e=>{const t=e.trim().toLowerCase();if(!t){r([],"");return}const n=s.filter(e=>{const n=[e.title,e.summary,e.content,Array.isArray(e.tags)?e.tags.join(" "):"",Array.isArray(e.series)?e.series.join(" "):""].join(" ").toLowerCase();return n.includes(t)});r(n,t)};fetch(l).then(e=>e.json()).then(e=>{s=Array.isArray(e)?e:[]}).catch(()=>{t.textContent="搜索索引加载失败"});let c=null;n.addEventListener("input",e=>{clearTimeout(c),c=setTimeout(()=>u(e.target.value),150)})})()